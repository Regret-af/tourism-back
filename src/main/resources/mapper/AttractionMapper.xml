<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.af.tourism.mapper.AttractionMapper">

    <!-- 景点列表查询，遵循接口文档：仅返回 status=1 的可见数据 -->
    <select id="selectAttractions" resultType="com.af.tourism.pojo.entity.Attraction">
        SELECT
            id, name, description, location, image_url, gallery, rating, tags, view_count, price_level, status, longitude, latitude, created_at, updated_at
        FROM attractions
        <where>
            status = 1
            <if test="queryDTO.q != null and queryDTO.q != ''">
                AND (
                    name LIKE CONCAT('%', #{queryDTO.q}, '%')
                    OR location LIKE CONCAT('%', #{queryDTO.q}, '%')
                    OR tags LIKE CONCAT('%', #{queryDTO.q}, '%')
                )
            </if>
            <if test="queryDTO.location != null and queryDTO.location != ''">
                AND location = #{queryDTO.location}
            </if>
            <if test="queryDTO.priceLevel != null">
                AND price_level = #{queryDTO.priceLevel}
            </if>
            <if test="queryDTO.tagList != null and queryDTO.tagList.size() > 0">
                AND (
                <foreach collection="queryDTO.tagList" item="tag" separator="OR">
                    FIND_IN_SET(#{tag}, tags)
                </foreach>
                )
            </if>
        </where>
        ORDER BY ${queryDTO.sortSpec.column} ${queryDTO.sortSpec.order}
    </select>

</mapper>
